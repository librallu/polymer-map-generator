<html><head><link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/app-layout/app-toolbar/app-toolbar.html">



</head><body><dom-module id="gen-map-app">
  <template>
    <style>
      :host {
        margin: 0;
        padding: 0;
        display: block;
        text-align: center;
        font-family: sans-serif;
        --app-primary-color: #1EAE55;
        --app-secondary-color: black;
      }

      paper-button {
        background-color: var(--app-primary-color);
        color: white;
        display: block;
        width: 200px;
        margin: auto;
        margin-top: 10px;
        text-align: center;
        font-weight: bold;
      }

      app-toolbar {
        /* Toolbar is the main header, so give it some color */
        background-color: var(--app-primary-color);
        font-family: Helvetica, sans-serif;
        color: white;
        --app-toolbar-font-size: 24px;
      }

      #visu {
          margin: auto;
          display: block;
          background-color: #ddd;
          margin-top: 20px;
          margin-bottom: 20px;
      }
    </style>

      <app-toolbar>
        <div main-title="">Map Generator</div>
      </app-toolbar>

      <canvas id="visu" height="513px" width="513px"></canvas>

      <paper-button on-tap="generateAction">GENERATE</paper-button>

      <p>Inspired by the excellent article <a href="http://linuxfr.org/news/je-cree-mon-jeu-video-e10-generation-procedurale-de-carte-partie-1#diamant-carr%C3%A9-diamond-square" alt="linuxfr.org">from linuxfr.org</a></p>

    

  </template>

  <script>Polymer({is:"gen-map-app",properties:{prop1:{type:String,value:"gen-map-app"},size:{type:Number,value:513}},genMap:function(){for(var a=[],t=0;t<this.size;t++){a.push([]);for(var r=0;r<this.size;r++)a[t].push(0)}var e=this.size;a[0][0]=Math.random(),a[0][e-1]=Math.random(),a[e-1][e-1]=Math.random(),a[e-1][0]=Math.random();for(var i=.9,o=e-1,s=Math.floor(o/2);o>1;){for(var t=s;t<e;t+=o)for(var r=s;r<e;r+=o)a[t][r]=(a[t-s][r-s]+a[t+s][r-s]+a[t-s][r+s]+a[t+s][r+s])/4+i*(Math.random()-.5);for(var t=0;t<e;t+=s)for(var r=s*(1-t/s%2);r<e;r+=o)0==t?a[t][r]=(a[t+s][r]+a[t][r-s]+a[t][r+s])/3+i*(Math.random()-.5):0==r?a[t][r]=(a[t-s][r]+a[t+s][r]+a[t][r+s])/3+i*(Math.random()-.5):t==e-1?a[t][r]=(a[t-s][r]+a[t][r-s]+a[t][r+s])/3+i*(Math.random()-.5):r==e-1?a[t][r]=(a[t-s][r]+a[t+s][r]+a[t][r-s])/3+i*(Math.random()-.5):a[t][r]=(a[t-s][r]+a[t+s][r]+a[t][r-s]+a[t][r+s])/4+i*(Math.random()-.5);o=s,s=Math.floor(o/2),i/=2}for(var h=a[0][0],n=a[0][0],t=0;t<e;t++)for(var r=0;r<e;r++)h=Math.max(h,a[t][r]),n=Math.min(n,a[t][r]);for(var t=0;t<e;t++)for(var r=0;r<e;r++)a[t][r]=(a[t][r]-n)/(h-n);return a},ready:function(){return this.canvas=this.querySelector("#visu"),this.canvas?(this.context=this.canvas.getContext("2d"),this.context?(this.ramp=new Image,this.ramp.src="ramp.png",self=this,void(this.ramp.onload=function(){var a=self.genMap();self.drawMap(a)})):void alert("Impossible to retrieve canvas's context")):void alert("Impossible to retrieve canvas element...")},generateAction:function(){var a=self.genMap();self.drawMap(a)},drawMap:function(a){this.canvas.width=this.size,this.canvas.height=this.size;var t=document.createElement("canvas");t.width=this.ramp.width,t.height=1,t.getContext("2d").drawImage(this.ramp,0,0,this.ramp.width,1);for(var r=t.getContext("2d").getImageData(0,0,t.width,1).data,e=this.context.createImageData(this.size,this.size),i=e.data,o=0;o<this.size;o++)for(var s=0;s<this.size;s++){var h=4*(o*this.size+s),n=a[o][s];i[h]=r[4*Math.floor(n*t.width)],i[h+1]=r[4*Math.floor(n*t.width)+1],i[h+2]=r[4*Math.floor(n*t.width)+2],i[h+3]=r[4*Math.floor(n*t.width)+3]}this.context.putImageData(e,0,0)}});</script>
</dom-module>
</body></html>